<!-- Claim Detail Content for Right Panel -->
<div class="detail-section">
  <h3>Claim Information</h3>
  <div class="detail-grid">
    <div class="detail-item">
      <span class="detail-label">Patient</span>
      <span class="detail-value">{{ claim.patient_name|default:"N/A" }}</span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Discharge Date</span>
      <span class="detail-value">{{ claim.discharge_date|date:"m/d/Y" }}</span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Billed Amount</span>
      <span class="detail-value">${{ claim.billed_amount|floatformat:2 }}</span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Paid Amount</span>
      <span
        class="detail-value {% if claim.paid_amount > 0 %}text-green-600{% else %}text-red-600{% endif %}"
      >
        ${{ claim.paid_amount|floatformat:2 }}
      </span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Insurer</span>
      <span class="detail-value">{{ claim.insurer_name|default:"N/A" }}</span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Denial Reason</span>
      <span class="detail-value"
        >{{ claim.details.first.denial_reason|default:"N/A" }}</span
      >
    </div>
  </div>

  {% if claim_details %}
  <div style="margin-top: 1rem">
    <span class="detail-label">CPT Codes:</span>
    <div class="cpt-codes">
      {% for detail in claim_details %} {% if detail.cpt_code%}
      <span class="cpt-code">{{ detail.cpt_code }}</span>
      {% endif %} {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<div class="detail-section">
  <h3>Notes & Annotations</h3>

  {% if claim_notes or claim_flags %}
  <div class="notes-section">
    <!-- Dynamic Notes from Database -->
    {% for note in claim_notes %}
    <div class="note-item">
      <div class="note-header">
        <span class="note-type" style="margin-right: 5px"
          >{{ note.user.username }}</span
        >
        <span class="note-time"
          >{{ note.created_at|date:"M. j, Y, g:i a" }}</span
        >
      </div>
      <div class="note-content">{{ note.content }}</div>
    </div>
    {% endfor %}

    <!-- Dynamic Flags from Database -->
    {% for flag in claim_flags %}
    <div class="note-item system">
      <div class="note-header">
        <span class="note-type">SYSTEM FLAG</span>
        <span class="note-time"
          >{{ flag.created_at|date:"M. j, Y, g:i a" }}</span
        >
      </div>
      <div class="note-content">
        {{ flag.reason }} {% if flag.resolved %}
        <br /><small style="color: #059669; font-weight: 600"
          >âœ“ Resolved by {{ flag.resolved_by.username }}</small
        >
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <p>No notes or annotations yet.</p>
  </div>
  {% endif %}

  <!-- Quick Actions Section -->
  <div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="quick-actions-buttons">
      <button
        class="quick-action-btn"
        onclick="parent.showFlagModal('{{ claim.claim_id }}')"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"
          ></path>
          <line x1="4" y1="22" x2="4" y2="15"></line>
        </svg>
        Flag for Review
      </button>

      <button
        class="quick-action-btn"
        onclick="parent.showNoteModal('{{ claim.claim_id }}')"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
          ></path>
        </svg>
        Add Note
      </button>
    </div>
  </div>
</div>
